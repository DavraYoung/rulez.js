/*! rulez.js 2015-10-09 */
var Rulez=function(a){"use strict";function b(a){var c,d=a.cloneNode(!1);if(a instanceof Element){var e=window.getComputedStyle(a);if(e)for(c=0;c<e.length;c++){var f=e[c];d.style.setProperty(f,e.getPropertyValue(f),"")}}for(c=0;c<a.childNodes.length;c++)d.appendChild(b(a.childNodes[c]));return d}function c(){H||C.divisions.forEach(function(a){a.pixelGap>H&&(H=a.pixelGap)}),x=y-y%H+H*D,w=-H*D}function d(a,b){C.divisions.forEach(function(c){e(a,b,c)});var c=0;C.texts.forEach(function(d){var e=f(a,b,d);E[c]?E[c]=E[c].concat(e):E.push(e),c++})}function e(a,b,c){for(var d=a;b>d;d+=c.pixelGap){var e=g(d,c);v.appendChild(e),c.renderer&&c.renderer(e)}}function f(a,b,c){for(var d=[],e=a;b>e;e+=c.pixelGap){var f=j(e,c);v.appendChild(f),c.renderer&&c.renderer(f),d.push(f)}return d}function g(a,b){switch(b.type){case"line":return h(a,b);case"rect":return i(a,b);default:return i(a,b)}}function h(a,b){var c,d,e,f,g=document.createElementNS(A,"line"),h=m();return l()?(c="y1",d="y2",e="x1",f="x2"):(c="x1",d="x2",e="y1",f="y2"),g.setAttribute("class",b.className),g.setAttribute(c,p(a)),g.setAttribute(d,p(a)),g.setAttribute(e,p(h?"0":n()-b.lineLength)),g.setAttribute(f,p(h?b.lineLength:n())),g.setAttribute("stroke-width",p(b.strokeWidth)),g}function i(a,b){var c,d,e,f,g=document.createElementNS(A,"rect"),h=m();return l()?(c="y",d="x",e="width",f="height"):(c="x",d="y",e="height",f="width"),g.setAttribute("class",b.className),g.setAttribute(c,p(a)),g.setAttribute(d,p(h?"0":n()-b.lineLength)),g.setAttribute(e,p(b.lineLength)),g.setAttribute(f,p(b.strokeWidth)),g}function j(a,b){var c,d,e=document.createElementNS(A,"text"),f=t(b);return e.setAttribute("class",b.className),l()?(c="y",d="x"):(c="x",d="y"),e.origPos=a,e.origPosAttribute=c,e.setAttribute(c,p(a)),e.setAttribute(d,p(f)),s(e,b),e.textContent=b.showUnits?p(a):a,b.centerText&&r(e,b),e}function k(){return document.createElementNS(A,"g")}function l(){return"vertical"===C.layout}function m(){return!("bottom"===C.alignment||"right"===C.alignment)}function n(){return l()?C.width:C.height}function o(a,b,c){if(!b)return a;for(var d in b)if(b.hasOwnProperty(d))switch(d){case"divisionDefaults":case"textDefaults":o(a[d],b[d]);break;default:c&&a[d]||(a[d]=b[d])}return a.divisions&&a.divisions.forEach(function(b){o(b,a.divisionDefaults,b),b.className||(b.className="line"===b.type?"rulez-line":"rulez-rect")}),a.texts&&a.texts.forEach(function(b){o(b,a.textDefaults,b)}),a}function p(a){return a+C.units}function q(){if(""===C.units||"px"===C.units)return 1;var a=document.createElement("div");a.style.position="absolute",a.style.top="-100000px",a.style.left="-100000px",a.style.zIndex=-1e5,a.style.width=a.style.height=p(1),document.body.appendChild(a);var b=window.getComputedStyle(a).width.replace("px","");return document.body.removeChild(a),b}function r(a,b){a.getBoundingClientRect&&(a.setAttribute(a.origPosAttribute,u(a,b)+""),s(a,b))}function s(a,b){var c,d=a.origPos,e=t(b);b.centerText&&a.getBoundingClientRect&&(d=u(a,b)),c=l()?"rotate("+b.rotation+" "+e*z+" "+d*z+")":"rotate("+b.rotation+" "+d*z+" "+e*z+")",a.setAttribute("transform",c)}function t(a){var b=m();return b?a.offset:n()-a.offset}function u(a,b){var c;try{c=a.getBoundingClientRect()}catch(d){c={width:0,height:0}}return a.origPos+c[b.centerText.by]/2*("sum"===b.centerText.operation?1:-1)}var v,w,x,y,z,A="http://www.w3.org/2000/svg",B={width:null,height:null,element:null,layout:"horizontal",alignment:"top",units:"",divisionDefaults:{strokeWidth:1,type:"rect",className:"rulez-rect",renderer:null},textDefaults:{rotation:0,offset:25,className:"rulez-text",showUnits:!1,centerText:{by:"width",operation:"sub"},renderer:null},divisions:[{pixelGap:5,lineLength:5},{pixelGap:25,lineLength:10},{pixelGap:50,lineLength:15},{pixelGap:100,lineLength:20}],texts:[{pixelGap:100}]},C=o(JSON.parse(JSON.stringify(B)),a),D=2,E=[],F=0,G=1,H=0;this.render=function(){C.width||(C.width=C.element.getBoundingClientRect().width),C.height||(C.height=C.element.getBoundingClientRect().height),C.element.appendChild(v=k()),y=l()?C.height:C.width,z=q(),c(),d(w,x),this.scrollTo(0,!1)},this.scrollTo=function(a,b){F=a,b&&(F*=z),l()?v.setAttribute("transform","translate(0,"+-F%(H*z)+")"):v.setAttribute("transform","translate("+-F%(H*z)+",0)");for(var c=F/z,d=0;d<C.texts.length;d++)for(var e=C.texts[d],f=E[d],g=H/e.pixelGap,h=c%H,i=c-h,j=0;j<f.length;j++){var k=f[j],m=Math.floor((i+(j-D*g)*e.pixelGap)*G);e.showUnits&&(m=p(m)),k.textContent=m,e.centerText&&r(k,e)}},this.setScale=function(a){G=a,this.scrollTo(F,!1)},this.resize=function(){var a=y,b=l()?C.element.clientHeight:C.element.clientWidth;if(a!==b)if(a>b);else{y=b;var e=x;c(),d(e,x),this.scrollTo(F,!1)}},this.saveAsImage=function(a){var c=b(C.element);c.setAttribute("width",C.width),c.setAttribute("height",C.height);var d=document.createElement("canvas");d.setAttribute("width",C.width),d.setAttribute("height",C.height);var e=d.getContext("2d"),f=window.URL||window.webkitURL,g=new Image;g.style.position="absolute",g.style.top="-100000px",g.style.left="-100000px",g.style.zIndex=-1e5,g.setAttribute("width",C.width),g.setAttribute("height",C.height);var h=new Blob([c.outerHTML],{type:"image/svg+xml;charset=utf-8"}),i=f.createObjectURL(h);g.onload=function(){setTimeout(function(){e.drawImage(g,0,0),f.revokeObjectURL(i),document.body.removeChild(g),a(d.toDataURL())},1e3)},document.body.appendChild(g),g.src=i},this.getUnitConversionRate=function(){return q()}};