/*! rulez.js 2015-02-18 */
var Rulez=function(a){"use strict";function b(a){var c,d=a.cloneNode(!1);if(a instanceof Element){var e=window.getComputedStyle(a);if(e)for(c=0;c<e.length;c++){var f=e[c];d.style.setProperty(f,e.getPropertyValue(f),"")}}for(c=0;c<a.childNodes.length;c++)d.appendChild(b(a.childNodes[c]));return d}function c(){y||r.divisions.forEach(function(a){a.pixelGap>y&&(y=a.pixelGap)}),o=x-x%y+y*s,n=-y*s}function d(a,b){r.divisions.forEach(function(c){e(a,b,c)});var c=0;r.texts.forEach(function(d){var e=f(a,b,d);u[c]?u[c]=u[c].concat(e):u.push(e),c++})}function e(a,b,c){for(var d=a;b>d;d+=c.pixelGap){var e=g(d,c);c.renderer&&c.renderer(e),t.appendChild(e)}}function f(a,b,c){for(var d=[],e=a;b>e;e+=c.pixelGap){var f=j(e,c);t.appendChild(f),c.renderer&&c.renderer(f),d.push(f)}return d}function g(a,b){switch(b.type){case"line":return h(a,b);case"rect":return i(a,b);default:return i(a,b)}}function h(a,b){var c,d,e,f,g=document.createElementNS(p,"line");return l()?(c="y1",d="y2",e="x1",f="x2"):(c="x1",d="x2",e="y1",f="y2"),g.setAttribute("class",b.className),g.setAttribute(c,a),g.setAttribute(d,a),g.setAttribute(e,"0"),g.setAttribute(f,b.lineLength),g.setAttribute("stroke-width",b.strokeWidth),g}function i(a,b){var c,d,e,f,g=document.createElementNS(p,"rect");return l()?(c="y",d="x",e="width",f="height"):(c="x",d="y",e="height",f="width"),g.setAttribute("class",b.className),g.setAttribute(c,a),g.setAttribute(d,"0"),g.setAttribute(e,b.lineLength),g.setAttribute(f,b.strokeWidth),g}function j(a,b){var c,d,e,f=document.createElementNS(p,"text");return f.setAttribute("class",b.className),l()?(c="y",d="x",e="rotate("+b.rotation+" "+b.offset+" "+a+")"):(c="x",d="y",e="rotate("+b.rotation+" "+a+" "+b.offset+")"),f.setAttribute(c,a),f.setAttribute(d,b.offset),f.setAttribute("transform",e),f.textContent=a,f}function k(){return document.createElementNS(p,"g")}function l(){return"vertical"===r.layout}function m(a,b,c){if(!b)return a;for(var d in b)if(b.hasOwnProperty(d))switch(d){case"divisionDefaults":case"textDefaults":m(a[d],b[d]);break;default:c&&a[d]||(a[d]=b[d])}return a.divisions&&a.divisions.forEach(function(b){m(b,a.divisionDefaults,b),b.className||(b.className="line"===b.type?"rulez-line":"rulez-rect")}),a.texts&&a.texts.forEach(function(b){m(b,a.textDefaults,b)}),a}var n,o,p="http://www.w3.org/2000/svg",q={width:null,height:null,element:null,layout:"horizontal",divisionDefaults:{strokeWidth:1,type:"rect",className:"rulez-rect"},textDefaults:{rotation:0,offset:25,className:"rulez-text"},divisions:[{pixelGap:5,lineLength:5},{pixelGap:25,lineLength:10},{pixelGap:50,lineLength:15},{pixelGap:100,lineLength:20}],texts:[{pixelGap:100}]},r=m(JSON.parse(JSON.stringify(q)),a),s=2,t=k(),u=[],v=0,w=1;r.width=r.width?r.width:r.element.getBoundingClientRect().width,r.height=r.height?r.height:r.element.getBoundingClientRect().height,r.element.appendChild(t);var x=l()?r.height:r.width,y=0;this.render=function(){c(),d(n,o)},this.scrollTo=function(a){v=a,l()?t.setAttribute("transform","matrix(1,0,0,1,0,"+-v%y+")"):t.setAttribute("transform","matrix(1,0,0,1,"+-v%y+",0)");for(var b=0;b<r.texts.length;b++)for(var c=r.texts[b],d=u[b],e=v%y,f=v-e,g=0;g<d.length;g++){var h=d[g];h.textContent=Math.floor((f+(g-s)*c.pixelGap)*w)}},this.setScale=function(a){w=a,this.scrollTo(v)},this.resize=function(){var a=x,b=l()?r.element.clientHeight:r.element.clientWidth;if(a!==b)if(a>b);else{x=b;var e=o;c(),d(e,o),this.scrollTo(v)}},this.saveAsImage=function(a){var c=b(r.element);c.setAttribute("width",r.width),c.setAttribute("height",r.height);var d=document.createElement("canvas");d.setAttribute("width",r.width),d.setAttribute("height",r.height);var e=d.getContext("2d"),f=window.URL||window.webkitURL,g=new Image;g.style.position="absolute",g.style.top="-100000px",g.style.left="-100000px",g.setAttribute("width",r.width),g.setAttribute("height",r.height);var h=new Blob([c.outerHTML],{type:"image/svg+xml;charset=utf-8"}),i=f.createObjectURL(h);g.onload=function(){setTimeout(function(){e.drawImage(g,0,0),f.revokeObjectURL(i),a(d.toDataURL())},1e3)},document.body.appendChild(g),g.src=i}};